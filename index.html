<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Typewriter Arena</title>
  <style>
    :root {
      --bg: #020617;
      --panel: #020617ee;
      --border: #1e293b;
      --accent: #22c55e;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --danger: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617, #000);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .screen {
      width: 100%;
      max-width: 980px;
      padding: 2rem;
      display: none;
    }

    .screen.active { display: block; }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 2rem;
      box-shadow: 0 30px 70px rgba(0,0,0,0.6);
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 0.25rem;
    }

    h2 {
      text-align: center;
      color: var(--muted);
      font-weight: 500;
      margin-bottom: 2rem;
    }

    /* SIGN IN */
    .signin {
      max-width: 420px;
      margin: 0 auto;
    }

    input {
      width: 100%;
      padding: 0.9rem 1rem;
      margin-bottom: 1rem;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #000;
      color: var(--text);
      font-size: 1rem;
    }

    button {
      width: 100%;
      padding: 0.9rem;
      border-radius: 14px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent), #16a34a);
      color: #020617;
      cursor: pointer;
    }

    button.secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
      margin-top: 0.75rem;
    }

    /* GAME */
    .layout {
      display: grid;
      grid-template-columns: 3fr 1.4fr;
      gap: 1.5rem;
    }

    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .text-box {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.25rem;
      font-size: 1.35rem;
      line-height: 2;
      min-height: 160px;
      margin-bottom: 1rem;
      background: #000;
    }

    .correct { color: var(--accent); }
    .incorrect { color: var(--danger); }
    .current { text-decoration: underline; }

    .leaderboard h3 {
      text-align: center;
      margin-bottom: 1rem;
    }

    .leaderboard ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .leaderboard li {
      display: flex;
      justify-content: space-between;
      padding: 0.6rem 0.8rem;
      border-bottom: 1px solid var(--border);
      font-size: 0.95rem;
    }

    .leaderboard li:last-child { border-bottom: none; }

    .footer {
      text-align: center;
      margin-top: 1rem;
      color: var(--muted);
      font-size: 0.9rem;
    }

    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- SIGN IN SCREEN -->
  <div id="signin-screen" class="screen active">
    <div class="card signin">
      <h1>Typewriter Arena</h1>
      <h2>Sign in to start typing</h2>
      <input id="username" placeholder="Enter a username" maxlength="16" />
      <button onclick="signIn()">Enter Arena</button>
    </div>
  </div>

  <!-- GAME SCREEN -->
  <div id="game-screen" class="screen">
    <div class="card">
      <div class="layout">
        <div>
          <div class="stats">
            <div>‚è± <span id="time">60</span>s</div>
            <div>‚ö° <span id="wpm">0</span> WPM</div>
            <div>üéØ <span id="accuracy">100</span>%</div>
          </div>

          <div id="text" class="text-box"></div>
          <input id="input" placeholder="Start typing‚Ä¶" />
          <button onclick="resetTest()">Restart</button>
        </div>

        <div class="leaderboard">
          <h3>üèÜ Your Best Runs</h3>
          <ul id="leaderboard"></ul>
          <button class="secondary" onclick="logout()">Switch User</button>
        </div>
      </div>
      <div class="footer">Scores are stored locally on this device only</div>
    </div>
  </div>

  <script>
    const passages = [
      "Typing is a skill built through patience consistency and focus.",
      "Speed comes naturally when accuracy becomes effortless.",
      "Great developers type fast because they think clearly first.",
      "Mechanical keyboards reward rhythm not force."
    ];

    let user = null;
    let testText = "";
    let timeLeft = 60;
    let timer = null;
    let started = false;

    const textDisplay = document.getElementById("text");
    const input = document.getElementById("input");
    const timeEl = document.getElementById("time");
    const wpmEl = document.getElementById("wpm");
    const accuracyEl = document.getElementById("accuracy");
    const leaderboardEl = document.getElementById("leaderboard");

    function signIn() {
      const name = document.getElementById("username").value.trim();
      if (!name) return;
      user = name;
      localStorage.setItem("activeUser", user);
      document.getElementById("signin-screen").classList.remove("active");
      document.getElementById("game-screen").classList.add("active");
      renderLeaderboard();
      resetTest();
    }

    function logout() {
      localStorage.removeItem("activeUser");
      location.reload();
    }

    function loadText() {
      testText = passages[Math.floor(Math.random() * passages.length)];
      textDisplay.innerHTML = "";
      testText.split("").forEach((c, i) => {
        const span = document.createElement("span");
        span.textContent = c;
        if (i === 0) span.classList.add("current");
        textDisplay.appendChild(span);
      });
    }

    function startTimer() {
      timer = setInterval(() => {
        timeLeft--;
        timeEl.textContent = timeLeft;
        updateStats();
        if (timeLeft <= 0) {
          clearInterval(timer);
          input.disabled = true;
          saveScore();
        }
      }, 1000);
    }

    function updateStats() {
      const typed = input.value.length;
      const words = typed / 5;
      const minutes = (60 - timeLeft) / 60;
      wpmEl.textContent = minutes > 0 ? Math.round(words / minutes) : 0;

      let correct = 0;
      [...textDisplay.children].forEach((s, i) => {
        if (input.value[i] === s.textContent) correct++;
      });
      accuracyEl.textContent = typed ? Math.round((correct / typed) * 100) : 100;
    }

    input.addEventListener("input", () => {
      if (!started) {
        started = true;
        startTimer();
      }

      let allCorrect = true;

      [...textDisplay.children].forEach((s, i) => {
        s.className = "";
        if (input.value[i] == null && i === input.value.length) {
          s.classList.add("current");
          allCorrect = false;
        } else if (input.value[i] === s.textContent) {
          s.classList.add("correct");
        } else {
          s.classList.add("incorrect");
          allCorrect = false;
        }
      });

      updateStats();

      // Stop test early if passage is fully typed correctly
      if (allCorrect && input.value.length === testText.length) {
        clearInterval(timer);
        input.disabled = true;
        saveScore();
      }
    });

    function saveScore() {
      const key = `scores-${user}`;
      const scores = JSON.parse(localStorage.getItem(key) || "[]");
      scores.push({ wpm: Number(wpmEl.textContent), acc: Number(accuracyEl.textContent) });
      scores.sort((a, b) => b.wpm - a.wpm);
      localStorage.setItem(key, JSON.stringify(scores.slice(0, 3)));
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const scores = JSON.parse(localStorage.getItem(`scores-${user}`) || "[]");
      leaderboardEl.innerHTML = scores.length
        ? scores.map((s, i) => `<li><span>#${i + 1}</span><strong>${s.wpm} WPM</strong></li>`).join("")
        : "<li>No scores yet</li>";
    }

    function resetTest() {
      clearInterval(timer);
      timeLeft = 60;
      started = false;
      input.disabled = false;
      input.value = "";
      timeEl.textContent = 60;
      wpmEl.textContent = 0;
      accuracyEl.textContent = 100;
      loadText();
    }

    const savedUser = localStorage.getItem("activeUser");
    if (savedUser) {
      user = savedUser;
      document.getElementById("signin-screen").classList.remove("active");
      document.getElementById("game-screen").classList.add("active");
      renderLeaderboard();
      resetTest();
    }
  </script>
</body>
</html>